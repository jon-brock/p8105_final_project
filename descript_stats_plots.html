<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Molly Martorella" />


<title>Descriptive stats plots</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Team 4</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown-header">Home</li>
<li class="dropdown-header">Statistics</li>
<li class="dropdown-header">Plots</li>
<li class="dropdown-header">Models</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Descriptive stats plots</h1>
<h4 class="author">Molly Martorella</h4>
<h4 class="date">12/3/2019</h4>

</div>


<div id="data" class="section level1">
<h1>Data</h1>
<div id="nyc-311" class="section level2">
<h2>NYC 311</h2>
<p>Load and tidy the data. Data is 100k randomly sampled complaints from all neighborhoods across all NYC boroughs (600k total samples). Years sampled were 2014-2018.</p>
<p>Data downloaded from: <a href="https://wetransfer.com/downloads/f8c5d6c17483e279ff56018db9c44cc420191201000026/c5f48b" class="uri">https://wetransfer.com/downloads/f8c5d6c17483e279ff56018db9c44cc420191201000026/c5f48b</a></p>
<pre class="r"><code>nyc &lt;- read_csv(file = &quot;../p8105nyc_311_100k.csv&quot;) %&gt;% 
    janitor::clean_names()</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   unique_key = col_double(),
##   created_year = col_double(),
##   created_time = col_time(format = &quot;&quot;),
##   incident_zip = col_double(),
##   landmark = col_logical(),
##   bbl = col_double(),
##   x_coordinate_state_plane = col_double(),
##   y_coordinate_state_plane = col_double(),
##   vehicle_type = col_logical(),
##   taxi_company_borough = col_logical(),
##   taxi_pick_up_location = col_logical(),
##   bridge_highway_name = col_logical(),
##   bridge_highway_direction = col_logical(),
##   road_ramp = col_logical(),
##   bridge_highway_segment = col_logical(),
##   latitude = col_double(),
##   longitude = col_double()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<pre class="r"><code>nyc_tidy &lt;- nyc %&gt;% 
    filter(borough != &quot;Unspecified&quot;) %&gt;% 
    separate(closed_date, 
             into = c(&quot;closed_month&quot;,&quot;closed_day&quot;,&quot;closed_year&quot;), 
             sep = &quot;\\/&quot; ) %&gt;%
    separate(closed_year, 
             into = c(&quot;closed_year&quot;,&quot;closed_time&quot;), 
             sep = &quot; &quot;) %&gt;% 
    mutate(
        created_year = as.numeric(created_year),
        created_month = as.numeric(created_month),
        created_day = as.numeric(created_day),
        city = as.factor(city),
        status = as.factor(status),
        borough = as.factor(borough),
        agency = as.factor(agency),
        complaint_type = as.factor(complaint_type),
        community_board = as.factor(community_board),
        open_complaint = ifelse(is.na(closed_year),  yes = 1, no = 0),
        complaint_simp = case_when(
            str_detect(complaint_type, 
                       regex(&quot;street&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;sidewalk&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;curb&quot;, ignore_case = TRUE)) ~ &quot;Street Condition&quot;,
            str_detect(complaint_type, 
                       regex(&quot;noise&quot;, ignore_case = TRUE)) ~ &quot;Noise&quot;,
            str_detect(complaint_type, 
                       regex(&quot;heat&quot;, ignore_case = TRUE)) ~ &quot;Heat&quot;,
            str_detect(complaint_type, 
                       regex(&quot;water&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;leak&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;plumbing&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;boiler&quot;, ignore_case = TRUE)) ~ &quot;Water/plumbing&quot;,
            str_detect(complaint_type, 
                       regex(&quot;paint&quot;, ignore_case = TRUE)) ~ &quot;Paint/Plaster&quot;,
            str_detect(complaint_type, 
                       regex(&quot;asbestos&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;lead&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;hazard&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;mold&quot;, ignore_case = TRUE)) ~ &quot;Hazard Material&quot;,
            str_detect(complaint_type, 
                       regex(&quot;elevator&quot;, ignore_case = TRUE)) 
            |str_detect(complaint_type, 
                        regex(&quot;maintenance&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;electric&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;stairs&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;window&quot;, ignore_case = TRUE)) 
            |str_detect(complaint_type, 
                        regex(&quot;appliance&quot;, ignore_case = TRUE)) ~ &quot;Maintenance&quot;,
            str_detect(complaint_type, 
                       regex(&quot;sanita&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;rodent&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;dirty&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;sew&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;standing water&quot;, ignore_case = TRUE)) ~ &quot;Sanitation&quot;,
            str_detect(complaint_type, 
                       regex(&quot;tree&quot;, ignore_case = TRUE)) ~ &quot;Tree&quot;,
            str_detect(complaint_type, 
                       regex(&quot;parking&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;car&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;drive&quot;, ignore_case = TRUE))
            |str_detect(complaint_type,  
                        regex(&quot;vehicle&quot;, ignore_case = TRUE))
            |str_detect(complaint_type,  
                        regex(&quot;traffic&quot;, ignore_case = TRUE)) ~ &quot;Car/Traffic&quot;,
            str_detect(complaint_type, 
                       regex(&quot;air&quot;, ignore_case = TRUE)) ~ &quot;Air Quality&quot;,
            str_detect(complaint_type, 
                       regex(&quot;collection&quot;, ignore_case = TRUE)) ~ &quot;Collection&quot;,
            str_detect(complaint_type, 
                       regex(&quot;homeless&quot;, ignore_case = TRUE))
            |str_detect(complaint_type, 
                        regex(&quot;panhandling&quot;, ignore_case = TRUE)) ~ &quot;Homeless&quot;),
        health_complaint = ifelse(
            complaint_simp %in% c(&quot;Heat&quot;, &quot;Water/Plumbing&quot;, &quot;Hazard Material&quot;, &quot;Sanitation&quot;, &quot;Air Quality&quot;), yes = 1, no = 0),
        complaint_simp = as.factor(complaint_simp),
        open_health_complaint = case_when(
            open_complaint == 1 &amp; health_complaint == 1 ~ 1,
            open_complaint == 0 | health_complaint == 0 ~ 0
        ),
        openCorr = ifelse(status == &quot;Closed&quot;, yes = 0, no = 1),
        status = as.factor(status)
    )</code></pre>
<p>Used skimr::skim, colnames, and levels(factor(nyc$complaint_type)) to investigate and tidy the data. New variables were created to establish a binary status for closed (0) or open (1) complaints.</p>
<p>Key variables include: <code>year</code>, <code>borough</code>, <code>community_board</code>, <code>complaint_type</code>, and <code>status</code>.</p>
<p>Newly added variables include:</p>
<ol style="list-style-type: decimal">
<li><p><code>complaint_simp</code> - based on key words, condenses complaint types into the following categories:’</p></li>
<li><p><code>health_complaint</code> - binary yes (1) or no (0), based on health associated categories within <code>complaint_simp</code>.</p></li>
<li><p><code>open_health_complaint</code> - binary categorization, either health complaint that is open (1), or non-health related complaint or closed health complaint (0).</p></li>
<li><p><code>openCorr</code> - binary categorization, closed <code>status</code> (0), open (1)</p></li>
</ol>
</div>
<div id="income-and-population-characteristics-data" class="section level2">
<h2>Income and population characteristics data:</h2>
<p>The variable, <code>community_board</code>, will be used to left join NYC 311 data with income and population characteristics data sourced from American Community Survey by Community District.</p>
<pre class="r"><code>inc_df = read_csv(&quot;./Med_income_2017.csv&quot;) %&gt;% 
    janitor::clean_names() %&gt;% 
    mutate(
        inc_1000s = round(median_income/1000, 1),
        income_bracket = case_when(
            median_income &gt;= 20000 &amp; median_income &lt;= 30000 ~ &quot;20k-30k&quot;,
            median_income &gt; 30000 &amp; median_income &lt;= 40000 ~ &quot;30-40k&quot;,
            median_income &gt; 40000 &amp; median_income &lt;= 50000 ~ &quot;40-50k&quot;,
            median_income &gt; 50000 &amp; median_income &lt;= 60000 ~ &quot;50-60k&quot;,
            median_income &gt; 60000 &amp; median_income &lt;= 70000 ~ &quot;60-70k&quot;,
            median_income &gt; 70000 &amp; median_income &lt;= 80000 ~ &quot;70-80k&quot;,
            median_income &gt; 80000 &amp; median_income &lt;= 90000 ~ &quot;80-90k&quot;,
            median_income &gt; 90000 &amp; median_income &lt;= 100000 ~ &quot;90-100k&quot;,
            median_income &gt; 100000 &amp; median_income &lt;= 125000 ~ &quot;100-125k&quot;,
            median_income &gt; 125000 &amp; median_income &lt;= 150000 ~ &quot;125k+&quot;,
        ),
        income_bracket = as.factor(income_bracket)
    )</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   MapID = col_double(),
##   `Area Name` = col_character(),
##   Median_Income = col_double(),
##   community_board = col_character(),
##   per_blackNH = col_double(),
##   per_whiteNH = col_double(),
##   per_hisp = col_double(),
##   per_other = col_double()
## )</code></pre>
<pre class="r"><code>nyc_inc = left_join(nyc_tidy, inc_df, by = &quot;community_board&quot;)</code></pre>
<pre><code>## Warning: Column `community_board` joining factor and character vector,
## coercing into character vector</code></pre>
<p><code>income_bracket</code> and <code>inc_1000s</code> (rounds income and divides by 1000) variables were added to the neighborhood population characteristics data to ease downstream plots and analyses. The data were left joined using the <code>community_board</code> variable.</p>
</div>
<div id="combined-and-tidied-data-for-plotting" class="section level2">
<h2>Combined and tidied data for plotting</h2>
<pre class="r"><code>nyc_plots &lt;- nyc_inc %&gt;% 
    group_by(area_name, created_year) %&gt;%
    add_count(area_name, name = &quot;number_complaints&quot;) %&gt;% 
    mutate(
        num_unsolved = sum(open_complaint),
        num_health_complaint = sum(health_complaint),
        num_open_health = sum(open_health_complaint)
    ) %&gt;% 
    select(-unique_key, -city, -park_borough, -agency, -agency_name, -descriptor, -incident_zip, -incident_address, -street_name, -cross_street_1, -cross_street_2, -intersection_street_1, -intersection_street_2, -landmark, -facility_type, -resolution_description, -resolution_action_updated_date, -bbl, -x_coordinate_state_plane, -y_coordinate_state_plane, -open_data_channel_type, -park_facility_name, -vehicle_type, -taxi_company_borough, -taxi_pick_up_location, -bridge_highway_name, -bridge_highway_direction, -bridge_highway_segment, -latitude, -longitude, -location, -road_ramp, -location_type, -address_type, -map_id)</code></pre>
<p>The newly combined dataframe was grouped according to <code>area_name</code>, a key variable from the population characteristics dataset that provides the local neighborhood name within the borough. Extraneous variables were removed to reduce the dataframe size and ease manipulation of the data.</p>
<p>Newly added variables include:</p>
<ol style="list-style-type: decimal">
<li><p><code>number_complaints</code> - total number of complaints within the given neighborhood the complaint was filed.</p></li>
<li><p><code>num_unsolved</code> - total number of open/unresolved complaints within the neighborhood the complaint was filed.</p></li>
<li><p><code>num_health_complaint</code> - total number of health related complaints within the neighborhood the complaint was filed.</p></li>
<li><p><code>num_open_health</code> - total number of open/unresolved health complaints within the neighborhood the complaint was filed.</p></li>
</ol>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
